#Define variables
$RemoteComputer = Read-Host "Computer name"


Do {
$PCUP = "Offline"
If (Test-Connection -BufferSize 32 -Count 1 -ComputerName $RemoteComputer -Quiet) {
        $RemoteUser1 = Get-WmiObject -Class win32_computersystem -ComputerName "$RemoteComputer" | select username
        $RemoteUser2 = $RemoteUser1 -creplace '^[^\\]*\\', ''
        $RemoteUser3 = $RemoteUser2.substring(0,$RemoteUser2.Length-1)
                If ($RemoteUser3 -eq "@{username=")
                    {$RemoteUser3 = "No User has logged in"
                    Write-Host -ForegroundColor Green "The remote machine is Online"
                    Write-Host -ForegroundColor DarkGreen "Current or Last Logged in user is: $RemoteUser3"
                    $User = "No"
                    }
                    Else {
                    Write-Host -ForegroundColor Green "The remote machine is Online"
                    Write-Host -ForegroundColor RED "WARNING: A User may be actively using this machine verify before restarting!"
                    Write-Host -ForegroundColor DarkRed "Current or Last Logged in user is: $RemoteUser3"
                    $User = "Yes"
       
                    }

$Header = tasklist /s mj-tc-001 /FI "Username eq zvanroekel" /FI "Session ne 0" |Select -First 3
   
                
Do {$CheckProcesses = Read-Host "Would you like to see their open processes? (Y/N)" } While ($CheckProcesses -notmatch "Y|N")
$CheckProcesses = $CheckProcesses.substring(0,1)
If ($CheckProcesses -eq "N"){}
ElseIf ($User -eq "Yes"){
    If ($CheckProcesses -eq "Y") {
        $Header
        tasklist /s $RemoteComputer /FI "Username eq $RemoteUser3" /FI "Session ne 0" | Select -Skip 3 |sort
        Write-Host "Showing $RemoteUser3's Proccesses"}
        }
     Elseif ($User -eq "No"){
    tasklist /s $RemoteComputer
    Write-Host "Showing System Proccesses"}

                   
$PCUP = "Online"

} Else {
        Set-ExecutionPolicy Restricted
        Write-Host -ForegroundColor Red "The remote machine is Down or Not connected to the internet. Please Verify & Try Again"
        Write-Host -ForegroundColor Red "The machine may not be on 'CUSD'"
		#Write-Host "Press any key to exit"
        #$Host.UI.RawUI.ReadKey("NoEcho,IncludeKeyDown")
        #(Get-Host).SetShouldExit(0)
        #Exit
        $RemoteComputer = Read-Host "Computer name"
}
}Until ($PCUP -eq "Online")

$NewComputerName = Read-Host "New Computer name"
$NewComputerName = "$NewComputerName".ToUpper()
Do { $Restart = Read-Host "Would you like to Restart?(Y/N)" } While ($Restart -notmatch "Y|N")
$Restart = $Restart.substring(0,1)
$Username = Read-Host "Your Username"
Write-Host "$RemoteComputer will be renamed $NewComputerName"
If ($Restart -eq "Y") {
    Rename-Computer -ComputerName "$RemoteComputer" -NewName "$NewComputerName" -DomainCredential Chico\$Username -Force -Restart
    Write-Host "The Device Will Now Restart; Run again to see if the new machine is online!"
    Set-ExecutionPolicy Restricted

}Elseif ($Restart -eq "N"){
    Rename-Computer -ComputerName "$RemoteComputer" -NewName "$NewComputerName" -DomainCredential Chico\$Username -Force
    Write-Host "$NewComputerName will need to be restarted if the user logs out" 
    Set-ExecutionPolicy Restricted
    }
$Host.UI.RawUI.ReadKey("NoEcho,IncludeKeyDown")
(Get-Host).SetShouldExit(0)
Exit

Else {
Write-Host "Press any key to exit"
$Host.UI.RawUI.ReadKey("NoEcho,IncludeKeyDown")
(Get-Host).SetShouldExit(0)
Exit}
